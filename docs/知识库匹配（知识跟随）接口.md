# 知识跟随接口文档

[[_TOC_]]

## 知识上传接口

`/hitachi_elevator/knowledge/upload`

```
{
    "method": "update",
    "data": [
        {
            "knowledge_id": "id1",
            "knowledge_group": "group1",
            "title": "知识点标题",
            "is_message": "短信 0 否 1是",
            "keyword": "关键词",
            "busi_cata_id": "所属业务目录ID",
            "busi_cata_name": "目录名称",
            "click_count": "话务员点击次数",
            "publish_date": "发布时间",
            "eff_date": "生效开始日期",
            "sys_org_id": "所属机构ID",
            "sys_org_name": "所属机构名称",
            "update_time": "更新时间",
            "annex_name": "附件名称",
            "queue_name": "队列名称",
            "exp_date": "失效时间",
            "create_time": "创建时间",
            "knowledge_type_name":"知识分类名称",
            "read_count": "阅读次数，字符串类型",
            "label ": "标签",
            "knowledge_type_path":"知识分类路径：广州知识库/公安队列/公安业务",
            "affair": ["关联事项1", "关联事项2"],
            "convergence": false,
            "is_bound_follow": false,
            "type_name_label": "政策解读",
            "contents":[
                {
                    "sub_title": "子标题1，没有子标题的情况下为空",
                    "sub_context":"子标题内容1,每段内容都以<br/>结束"
                },
                {
                    "sub_title": "子标题2",
                    "sub_context":"子标题内容2,每段内容都以<br/>结束"
                }
            ]
        }
    ]
}
```

- convergence (bool, 默认为 false): 是否是汇聚性知识
- is_bound_follow (bool, 默认为 false)：是否已经解绑，解绑的数据不会在小程序显示
- type_name_label (str, 默认为空字符串): 知识类型名称标签，对接人（吴世民）

出参：

```json
{
  "code": "200",
  "msg": "训练成功"
}
```

## 知识删除接口:

```json
{
  "method": "delete",
  "data": [
    {
      "knowledge_id": "id1",
      "knowledge_group": "group1"
    }
  ]
}
```

出参：

```json
{
  "code": "200",
  "msg": "删除成功"
}
```

## 知识跟随接口

### 是否需要知识跟随接口

`/hitachi_elevator/knowledge/need_follow`

```json
{
  "text": "我想办理房贷业务"
}
```

出参

```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "need_follow": true
  }
}
```

### 跟随接口

`/hitachi_elevator/knowledge/follow`

```json
{
    "knowledge_group": "group1"
    "top_k": 4
    "affair": "当前关联事项",
    "knowledge_type_name": "知识分类名称1,知识分类名称2",
    "is_bound_follow": false,
    "history": [
        "我要办证",
        "办身份证",
    ]
}
```

- "knowledge_type_name": 对应知识上传接口中的`knowledge_type_name`, 如果传多个,用逗号分隔
- is_bound_follow (bool, 默认为 false)：是否已经解绑，解绑的数据不会在小程序显示

出参

```json
{
  "code": 200,
  "msg": "success",
  "data": [
    {
      "knowledge_id": "id1",
      "knowledge_group": "group1",
      "title": "知识点标题",
      "is_message": "短信 0 否 1是",
      "keyword": "关键词",
      "busi_cata_id": "所属业务目录ID",
      "busi_cata_name": "目录名称",
      "click_count": "话务员点击次数",
      "publish_date": "发布时间",
      "eff_date": "生效开始日期",
      "content": "八)  社会<b class=\"match term0\">保险</b>经办机构业务部门...通过自查方式发现错  误审核<b class=\"match term1\">工伤保险</b>待遇和<b class=\"match term1\">工伤保险</b>基金支出的，  应当重新审核， 少发<b class=\"match term1\">工伤保险</b>待遇或者<b class=\"match term1\">工伤保险</b>基金支出的，  给予补发；  多  发<b class=\"match term1\">工伤保险</b>待遇或者<b class=\"match term1\">工伤保险</b>基金支出的，  应当追回",
      "sys_org_id": "所属机构ID",
      "sys_org_name": "所属机构名称",
      "update_time": "更新时间",
      "queue_name": "队列名称",
      "exp_date": "失效时间",
      "create_time": "创建时间",
      "type_name_label": "政策解读",
      "matched_terms": ["工伤", "保险", "工伤保险"],
      "keywords": ["搜索关键词1", "搜索关键词2"],
      "score": 0.8
    }
  ]
}
```

- keywords: 该参数为输入市民与话务员聊天记录后，经过模型生成的搜索关键词

注: 当`data`字段为空数组时,即为此句不需要进行知识跟随

## 知识搜索接口

`/hitachi_elevator/knowledge/search`

```json
{
  "knowledge_group": "group1",
  "context_query": "搜索内容  多个关键信息搜索以逗号隔开",
  "cate_name_query": "类目搜索内容",
  "sys_org_name": "机构名称搜索",
  "publish_start": "发布时间开始时间，数据格式：yyyy-MM-dd",
  "publish_end": "发布时间结束时间，数据格式：yyyy-MM-dd",
  "queue_name": "队列多称搜索，多个以空格隔开",
  "busi_cata_name": "知识类目搜索，多个以空格隔开",
  "keyword": "关键字搜索，多个以空格隔开",
  "annex_search": true,
  "orderby_filed": "排序字段，主要是根据发布时间排序。默认是根据分数排序",
  "orderby_sort": "排序方式asc：升序，desc：降序",
  "knowledge_type_name": "知识分类名称",
  "knowledge_type_path": "知识分类路径搜索",
  "label": "标签",
  "is_bound_follow": false,
  "page_size": 15,
  "page_num": 10
}
```

- is_bound_follow (bool, false): 是否只显示绑定数据，跟小程序显示有关

出参

```json
{
  "code": 200,
  "msg": "success",
  "total": 1,
  "data": [
    {
      "knowledge_id": "id1",
      "knowledge_group": "group1",
      "title": "知识点标题",
      "is_message": "短信 0 否 1是",
      "keyword": "关键词",
      "busi_cata_id": "所属业务目录ID",
      "busi_cata_name": "目录名称",
      "click_count": "话务员点击次数",
      "publish_date": "发布时间",
      "eff_date": "生效开始日期",
      "content": "八)  社会<b class=\"match term0\">保险</b>经办机构业务部门...通过自查方式发现错  误审核<b class=\"match term1\">工伤保险</b>待遇和<b class=\"match term1\">工伤保险</b>基金支出的，  应当重新审核， 少发<b class=\"match term1\">工伤保险</b>待遇或者<b class=\"match term1\">工伤保险</b>基金支出的，  给予补发；  多  发<b class=\"match term1\">工伤保险</b>待遇或者<b class=\"match term1\">工伤保险</b>基金支出的，  应当追回",
      "sys_org_id": "所属机构ID",
      "sys_org_name": "所属机构名称",
      "update_time": "更新时间",
      "queue_name": "队列名称",
      "exp_date": "失效时间",
      "create_time": "创建时间",
      "read_count": "阅读次数，字符串类型",
      "type_name_label": "政策解读",
      "matched_terms": ["工伤", "保险", "工伤保险"]
    }
  ]
}
```

## 搜索联想

/chat-docs/suggestion

```json
{
    "query": "工伤"
    "orderby_filed": "排序字段，主要是根据发布时间排序。默认是根据分数排序",
    "orderby_sort": "排序方式asc：升序，desc：降序",
    "is_bound_follow": false
}
```

- is_bound_follow (bool, 默认为 false)：是否已经解绑，解绑的数据不会在小程序显示

出参

```json
{
  "code": 200,
  "msg": "success",
  "data": [
    "<b class=\"match term0\">工伤</b>保险",
    "<b class=\"match term0\">工商</b>保险"
  ]
}
```

## 标签搜索接口

/chat-docs/terms
入参

```json
{
  "terms": ["工伤", "保险", "工伤保险"],
  "page_size": 15,
  "page_num": 10
}
```

出参，与知识搜索接口一样。

```json
{
  "code": 200,
  "msg": "success",
  "total": 1,
  "data": [
    {
      "knowledge_id": "id1",
      "knowledge_group": "group1",
      "title": "知识点标题",
      "is_message": "短信 0 否 1是",
      "keyword": "关键词",
      "busi_cata_id": "所属业务目录ID",
      "busi_cata_name": "目录名称",
      "click_count": "话务员点击次数",
      "publish_date": "发布时间",
      "eff_date": "生效开始日期",
      "content": "八)  社会<b class=\"match term0\">保险</b>经办机构业务部门...通过自查方式发现错  误审核<b class=\"match term1\">工伤保险</b>待遇和<b class=\"match term1\">工伤保险</b>基金支出的，  应当重新审核， 少发<b class=\"match term1\">工伤保险</b>待遇或者<b class=\"match term1\">工伤保险</b>基金支出的，  给予补发；  多  发<b class=\"match term1\">工伤保险</b>待遇或者<b class=\"match term1\">工伤保险</b>基金支出的，  应当追回",
      "sys_org_id": "所属机构ID",
      "sys_org_name": "所属机构名称",
      "update_time": "更新时间",
      "queue_name": "队列名称",
      "exp_date": "失效时间",
      "create_time": "创建时间",
      "read_count": "阅读次数，字符串类型",
      "matched_terms": ["工伤", "保险", "工伤保险"]
    }
  ]
}
```
